<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã€ç®¡ç†è€…ç”¨ã€‘å‰µæˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ A1ç­: ç®¡ç†ãƒ»é–‹ç™ºãƒªã‚½ãƒ¼ã‚¹</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="admin_style.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ« */
        #auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
        }
        .auth-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 350px;
            width: 90%;
        }
        .auth-form input {
            width: 90%;
            padding: 10px;
            margin: 8px 0 15px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .auth-form button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 90%;
            font-size: 18px;
        }
        .auth-form button:hover {
            background-color: #0056b3;
        }
        #auth-message {
            color: red;
            margin-top: 10px;
            font-weight: bold;
        }
        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºã«ã™ã‚‹ */
        #content-wrapper {
            display: none;
        }
        /* ç­å“¡ãƒãƒ£ãƒƒãƒˆã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
        .file-input {
            margin-bottom: 10px;
        }
        .file-attachment {
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .file-attachment img {
            display: block;
            margin-bottom: 5px;
            max-width: 100%; 
            height: auto;
        }
        .file-attachment a {
            word-break: break-all;
        }
        /* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .logout-button {
            background-color: #dc3545; /* èµ¤è‰² */
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 20px;
            transition: background-color 0.3s;
        }
        .logout-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>

<div id="auth-container">
    <div class="auth-form">
        <h2>ç®¡ç†è€…ã‚µã‚¤ãƒˆã¸ã‚ˆã†ã“ã</h2>
        <p>ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯èªè¨¼ãŒå¿…è¦ã§ã™ã€‚</p>
        <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å (ä¾‹: Yuto)" required>
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
        <button onclick="checkAuth()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <p id="auth-message"></p>
    </div>
</div>

<div id="content-wrapper">

<header class="navbar">
  <div class="navbar-container">
    <a href="./admin.html" class="logo">
    <img src="A1.png" alt="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ­ã‚´" class="logo">
    </a>
    
    <nav class="hero-tabs-container">
      <a href="#schedule" class="hero-tab-button">ä»Šå¾Œã®äºˆå®š</a>
      <a href="#resources" class="hero-tab-button">æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹</a>
      <a href="#code" class="hero-tab-button">èª¿æ•´ç”¨ã‚³ãƒ¼ãƒ‰</a>
      <a href="#chat" class="hero-tab-button">ç­å“¡ãƒãƒ£ãƒƒãƒˆ</a>
    </nav>
    
    <button onclick="logout()" class="logout-button">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

    <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
  </div>

  <div class="mobile-menu" id="mobileMenu">
    <a href="#schedule" onclick="toggleMenu()">ä»Šå¾Œã®äºˆå®šã‚’è¦‹ã‚‹</a>
    <a href="#resources" onclick="toggleMenu()">æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹</a>
    <a href="#code" onclick="toggleMenu()">èª¿æ•´ç”¨ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</a>
    <a href="#chat" onclick="toggleMenu()">ç­å“¡ãƒãƒ£ãƒƒãƒˆã‚’è¦‹ã‚‹</a>
  </div>
</header>
  

<section class="hero admin-hero">
    <div class="hero-content">
        <h1>ã€ç®¡ç†è€…ç”¨ã‚µã‚¤ãƒˆã€‘ A1ç­</h1>
        <h2>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ç®¡ç†ã¨é–‹ç™ºãƒªã‚½ãƒ¼ã‚¹å…±æœ‰ã®å ´</h2>
        <p>æ©Ÿå¯†æ€§ã®é«˜ã„æƒ…å ±ã‚’å«ã‚€ãŸã‚ã€é–¢ä¿‚è€…ã®ã¿åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
</section>

<section id="schedule" class="section light-bg">
    <h3>ğŸ—“ï¸ ä»Šå¾Œã®äºˆå®šã¨ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</h3>
    <p class="process-preamble">ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å‘ã‘ãŸä»Šå¾Œã®é‡è¦ã‚¿ã‚¹ã‚¯ã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
    <div class="process-container">
        
        <div class="step animate-on-scroll">
            <span class="step-number">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 1 (12/08)</span>
            <h4>â‘  Uã‚¿ãƒ¼ãƒ³ç²¾åº¦ 95% é”æˆ</h4>
            <p>ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ã®è§’åº¦èª¿æ•´ã¨DCãƒ¢ãƒ¼ã‚¿ã®PWMå€¤èª¿æ•´ã‚’å®Œäº†ã—ã€ç›®æ¨™ç²¾åº¦ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã€‚</p>
            <div class="status-indicator completed">âœ… å®Œäº†</div>
        </div>

        <div class="step animate-on-scroll">
            <span class="step-number">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 2 (12/15)</span>
            <h4>â‘¡ é›»æºç³»çµ± ãƒã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</h4>
            <p>é§†å‹•æ™‚ãŠã‚ˆã³ã‚µãƒ¼ãƒœåè»¢æ™‚ã®ãƒã‚¤ã‚³ãƒ³å‹•ä½œã®å®‰å®šæ€§ã‚’æœ€çµ‚ç¢ºèªã™ã‚‹ã€‚</p>
            <div class="status-indicator pending">âš ï¸ é€²è¡Œä¸­</div>
        </div>
        
        <div class="step animate-on-scroll">
            <span class="step-number">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ 3 (12/22)</span>
            <h4>â‘¢ æœ€çµ‚ãƒ‡ãƒ¢ç”¨ãƒ ãƒ¼ãƒ“ãƒ¼åˆ¶ä½œ</h4>
            <p>ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§˜å­ã‚’è¨˜éŒ²ã—ã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è³‡æ–™ã¨é€£æºã™ã‚‹ã€‚</p>
            <div class="status-indicator todo">âœï¸ æœªç€æ‰‹</div>
        </div>
    </div>
</section>

<section id="resources" class="section dark-bg">
    <h3>ğŸ”§ æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹</h3>
    <div class="tech-card-container">
        <div class="tech-card animate-on-scroll">
            <h4>å›è·¯å›³ (æœ€æ–°ç‰ˆ)</h4>
            <p>æœ€çµ‚æ±ºå®šã—ãŸé›»æºåˆ†é›¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€å›è·¯å›³ã®PDFã§ã™ã€‚èª¤é…ç·šãŒãªã„ã‹å¸¸ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
            <a href="./circuit_diagram_v3.pdf" class="resource-link">å›è·¯å›³ (PDF) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
            <img src="./kuwashiikairo.jpeg" alt="æœ€æ–°å›è·¯å›³" class="process-media">
        </div>
        <div class="tech-card animate-on-scroll">
            <h4>è»Šä½“ CAD ãƒ‡ãƒ¼ã‚¿ (STL)</h4>
            <p>3Dãƒ—ãƒªãƒ³ã‚¿ã§å‡ºåŠ›ã™ã‚‹ãŸã‚ã®STLãƒ•ã‚¡ã‚¤ãƒ«ãŠã‚ˆã³è¨­è¨ˆå…ƒã®STEPãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚</p>
            <a href="./chassis_v2.stl" class="resource-link">STLãƒ•ã‚¡ã‚¤ãƒ« ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
        </div>
        <div class="tech-card animate-on-scroll">
            <h4>éƒ¨å“ãƒªã‚¹ãƒˆ (Excel)</h4>
            <p>ä½¿ç”¨éƒ¨å“ã€å˜ä¾¡ã€èª¿é”çŠ¶æ³ã‚’ã¾ã¨ã‚ãŸãƒªã‚¹ãƒˆã§ã™ã€‚éƒ¨å“ã®äºˆå‚™ç™ºæ³¨ã«ã”æ´»ç”¨ãã ã•ã„ã€‚</p>
            <a href="./parts_list_v1.xlsx" class="resource-link">éƒ¨å“ãƒªã‚¹ãƒˆ (Excel) ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
        </div>
        <div class="tech-card animate-on-scroll">
            <h4>è¨­è¨ˆå¤‰æ›´ãƒ­ã‚°</h4>
            <p>ãƒ•ã‚¡ãƒ³é§†å‹•ã‹ã‚‰ã‚¿ã‚¤ãƒ¤é§†å‹•ã¸ã®å¤‰æ›´ãªã©ã€ä¸»è¦ãªè¨­è¨ˆå¤‰æ›´ã®çµŒç·¯ã¨ç†ç”±ã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚</p>
            <a href="./design_change_log.txt" class="resource-link">ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§</a>
        </div>
    </div>
</section>

<section id="code" class="section light-bg">
    <h3>ğŸ’» èª¿æ•´ç”¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ  (C++ / Arduino)</h3>
    <p class="process-preamble">ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ã¦èª¿æ•´ä¸­ã®åˆ¶å¾¡ã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«æ²è¼‰ã—ã¾ã™ã€‚æœ¬ç•ªã‚³ãƒ¼ãƒ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã«ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>

    <div class="code-display animate-on-scroll">
        <h5 class="text-lg font-medium mb-2 text-gray-800 dark:text-gray-200">æœ€æ–°èª¿æ•´ã‚³ãƒ¼ãƒ‰ (Uã‚¿ãƒ¼ãƒ³è§’åº¦æ”¹å–„ç‰ˆ)</h5>
        <div class="code-block-wrapper">
            <button class="copy-button" onclick="copyCode('adjustedCode')">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
            <div class="code-block">
<pre id="adjustedCode"><code>#include &lt;Arduino.h;>
#include &lt;Servo.h;>

// ----------------------------------------------------------------------
// I. ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
// ----------------------------------------------------------------------

Servo front_steer_servo; // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°åˆ¶å¾¡ç”¨ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼

// --- ã‚·ãƒ¼ã‚±ãƒ³ã‚¹çŠ¶æ…‹ã®å®šç¾©ï¼ˆèª²é¡Œã®é€²è¡Œã‚’ç®¡ç†ï¼‰ ---
enum SequenceState {
Â  WAIT_START = 0, // ãƒ”ãƒ¼ã‚¹å¾…æ©Ÿä¸­ï¼ˆãƒªã‚»ãƒƒãƒˆçŠ¶æ…‹ï¼‰
Â  DRIVING,Â  Â  Â  Â  // è‡ªå¾‹çš„ãªç›´é€²é§†å‹•ä¸­
Â  PAUSE,Â  Â  Â  Â  Â  // ãƒ”ãƒ¼ã‚¹é™¤å»ã«ã‚ˆã‚‹ä¸€æ™‚åœæ­¢ä¸­ï¼ˆé‡‘å±æ¤œå‡ºæ™‚ï¼‰
Â  COMPLETEÂ  Â  Â  Â  // èª²é¡Œå®Œäº†ï¼ˆæœªä½¿ç”¨ã®å¯èƒ½æ€§ã‚ã‚Šï¼‰
};
SequenceState current_state = WAIT_START;

// --- å‹•ä½œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆè©¦é¨“å¾Œã«èª¿æ•´ï¼‰ ---
const int DC_DRIVE_PWM = 200;Â  // DCãƒ¢ãƒ¼ã‚¿ãƒ¼ã®é§†å‹•é€Ÿåº¦ (0-255)
const int STEER_STRAIGHT = 90; // ã‚µãƒ¼ãƒœ: ç›´é€²è§’åº¦
const int STEER_LEFT = 140;Â  Â  // ã‚µãƒ¼ãƒœ: å·¦æ—‹å›è§’åº¦ (Uã‚¿ãƒ¼ãƒ³ç”¨)
const int STEER_RIGHT = 40;Â  Â  // ã‚µãƒ¼ãƒœ: å³æ—‹å›è§’åº¦ï¼ˆâ€»æœªä½¿ç”¨ï¼‰

// Uã‚¿ãƒ¼ãƒ³å‹•ä½œã«å¿…è¦ãªæ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰ - èª¿æ•´å¿…é ˆ â˜…
const unsigned long UTURN_DURATION_MS = 1500;

// --- ãƒ”ãƒ³å‰²ã‚Šå½“ã¦ ---
const int METAL_SENSOR_PIN = 3;Â  // é‡‘å±ã‚»ãƒ³ã‚µãƒ¼ã®å…¥åŠ›ãƒ”ãƒ³
const int SERVO_PIN = 9;Â  Â  Â  Â  Â // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚µãƒ¼ãƒœã®å‡ºåŠ›ãƒ”ãƒ³
const int DC_MOTOR_PWM = 5;Â  Â  Â  // å¾Œè¼ªDCãƒ¢ãƒ¼ã‚¿ãƒ¼ã®é€Ÿåº¦åˆ¶å¾¡ï¼ˆPWMï¼‰ãƒ”ãƒ³
const int DC_MOTOR_DIR = 6;Â  Â  Â  // å¾Œè¼ªDCãƒ¢ãƒ¼ã‚¿ãƒ¼ã®æ–¹å‘åˆ¶å¾¡ãƒ”ãƒ³

// --- ãƒ‡ãƒã‚¦ãƒ³ã‚¹å¤‰æ•° ---
unsigned long lastSensorChange = 0; // æœ€å¾Œã«ã‚»ãƒ³ã‚µãƒ¼å€¤ãŒå¤‰åŒ–ã—ãŸæ™‚é–“
const unsigned long DEBOUNCE_DELAY = 50; // ãƒ‡ãƒã‚¦ãƒ³ã‚¹é…å»¶æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
int lastMetalStatus = HIGH; // å‰å›ã®é‡‘å±ã‚»ãƒ³ã‚µãƒ¼ã®çŠ¶æ…‹ (HIGH=é‡‘å±ãªã—, LOW=é‡‘å±ã‚ã‚Š)


// ----------------------------------------------------------------------
// II. é§†å‹•ãƒ»åˆ¶å¾¡é–¢æ•°
// ----------------------------------------------------------------------

// å…¨ã¦ã®é§†å‹•ã‚’åœæ­¢ã•ã›ã‚‹
void stop_all_motors(void) {
Â  analogWrite(DC_MOTOR_PWM, 0); // DCãƒ¢ãƒ¼ã‚¿ãƒ¼ã®é€Ÿåº¦ã‚’0ã«è¨­å®š
Â  front_steer_servo.write(STEER_STRAIGHT); // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚’ç›´é€²ã«æˆ»ã™
}

// ç›´é€²é§†å‹•
void drive_forward() {
Â  front_steer_servo.write(STEER_STRAIGHT); // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã¯ç›´é€²
Â  digitalWrite(DC_MOTOR_DIR, HIGH); // å‰é€²æ–¹å‘
Â  analogWrite(DC_MOTOR_PWM, DC_DRIVE_PWM); // è¨­å®šé€Ÿåº¦ã§é§†å‹•
}

// å·¦æ—‹å›é§†å‹•ï¼ˆUã‚¿ãƒ¼ãƒ³ã®ä¸€æ®µéšï¼‰
void drive_turn_left() {
Â  front_steer_servo.write(STEER_LEFT); // ã‚¹ãƒ†ã‚¢ãƒªãƒ³ã‚°ã‚’å·¦æ—‹å›è§’åº¦ã«
Â  digitalWrite(DC_MOTOR_DIR, HIGH); // å‰é€²æ–¹å‘
Â  analogWrite(DC_MOTOR_PWM, DC_DRIVE_PWM); // è¨­å®šé€Ÿåº¦ã§é§†å‹•
}

// Uã‚¿ãƒ¼ãƒ³ã‚’è‡ªå¾‹çš„ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ï¼ˆèª²é¡Œå¿…é ˆå‹•ä½œï¼‰
void perform_uturn() {
Â  Serial.println("ğŸ”¥ Performing mandatory U-Turn...");
Â  // æŒ‡å®šæ™‚é–“ã ã‘å·¦æ—‹å›ã‚’è¡Œã†
Â  drive_turn_left();
Â  delay(UTURN_DURATION_MS); // æŒ‡å®šæ™‚é–“å¾…æ©Ÿ
Â  stop_all_motors(); // ä¸€æ—¦åœæ­¢
}

// çŠ¶æ…‹é·ç§»ã®ãŸã‚ã®é§†å‹•åœæ­¢å‡¦ç†ï¼ˆPAUSEçŠ¶æ…‹ã¸ç§»è¡Œï¼‰
void drive_motor_stop_pause() {
Â  stop_all_motors();
Â  current_state = PAUSE;
Â  Serial.println("â¸ï¸ State PAUSE (Piece removed).");
}


// ----------------------------------------------------------------------
// III. Arduino Setupã¨Loop
// ----------------------------------------------------------------------

void setup(void) {
Â  Serial.begin(9600); // PCã¨ã®ãƒ‡ãƒãƒƒã‚°ç”¨ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã‚’é–‹å§‹

Â  // ãƒ”ãƒ³è¨­å®š
Â  pinMode(DC_MOTOR_PWM, OUTPUT); // DCãƒ¢ãƒ¼ã‚¿ãƒ¼é€Ÿåº¦åˆ¶å¾¡
Â  pinMode(DC_MOTOR_DIR, OUTPUT); // DCãƒ¢ãƒ¼ã‚¿ãƒ¼æ–¹å‘åˆ¶å¾¡
Â  // METAL_SENSOR_PIN: LOW=é‡‘å±ã‚ã‚Š, HIGH=é‡‘å±ãªã—
Â  pinMode(METAL_SENSOR_PIN, INPUT_PULLUP); // å†…éƒ¨ãƒ—ãƒ«ã‚¢ãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¦ã‚»ãƒ³ã‚µãƒ¼ã‚’å…¥åŠ›ã«è¨­å®š

Â  front_steer_servo.attach(SERVO_PIN); // D9ãƒ”ãƒ³ã«ã‚µãƒ¼ãƒœã‚’æ¥ç¶š

Â  stop_all_motors(); // åˆæœŸçŠ¶æ…‹ã§å…¨ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’åœæ­¢
Â  Serial.println("System Ready. Autonomous Mode Active.");
}


void loop(void) {
Â  // 1. ã‚»ãƒ³ã‚µãƒ¼èª­ã¿å–ã‚Šï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ï¼‰
Â  int raw_metal_status = digitalRead(METAL_SENSOR_PIN);
Â  int metal_status = raw_metal_status;

Â  // ã‚»ãƒ³ã‚µãƒ¼å€¤ãŒå‰å›ã¨ç•°ãªã‚‹å ´åˆã€ãƒ‡ãƒã‚¦ãƒ³ã‚¹é–‹å§‹æ™‚é–“ã‚’è¨˜éŒ²
Â  if (raw_metal_status != lastMetalStatus) {
Â  Â  lastSensorChange = millis();
Â  }

Â  // 2. å®‰å®šã—ãŸã‚»ãƒ³ã‚µãƒ¼å€¤ã§ã®çŠ¶æ…‹é·ç§»åˆ¤å®šï¼ˆèª²é¡Œã®é€²è¡Œï¼‰
Â  if ((millis() - lastSensorChange) > DEBOUNCE_DELAY) {
Â  Â  metal_status = raw_metal_status;

Â  Â  // å®‰å®šã—ãŸã‚»ãƒ³ã‚µãƒ¼å€¤ã§çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
Â  Â  switch (current_state) {

Â  Â  Â  case WAIT_START:
Â  Â  Â  Â  // ã€ãƒ”ãƒ¼ã‚¹ã‚’ç½®ãã€‘(LOW) -> é§†å‹•é–‹å§‹ (DRIVING)
Â  Â  Â  Â  if (metal_status == LOW) {
Â  Â  Â  Â  Â  current_state = DRIVING;
Â  Â  Â  Â  Â  Serial.println("â–¶ï¸ DRIVING state started.");
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case DRIVING:
Â  Â  Â  Â  // AIæŒ‡ä»¤ãŒãªã„ãŸã‚ã€ç›´é€²ã‚’ç¶™ç¶š
Â  Â  Â  Â  drive_forward();

Â  Â  Â  Â  // ã€ãƒ”ãƒ¼ã‚¹ã‚’å–ã‚‹ã€‘(HIGH) -> ä¸€æ™‚åœæ­¢ã¸ (PAUSE)
Â  Â  Â  Â  if (metal_status == HIGH) {
Â  Â  Â  Â  Â  drive_motor_stop_pause(); // ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’åœæ­¢ã—ã€PAUSEçŠ¶æ…‹ã¸
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case PAUSE:
Â  Â  Â  Â  // ã€ãƒ”ãƒ¼ã‚¹ã‚’ç½®ãã€‘(LOW) -> Uã‚¿ãƒ¼ãƒ³å®Ÿè¡Œå¾Œã«é§†å‹•å†é–‹
Â  Â  Â  Â  if (metal_status == LOW) {
Â  Â  Â  Â  Â  // èª²é¡Œãƒ«ãƒ¼ãƒ«: Uã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ
Â  Â  Â  Â  Â  perform_uturn();

Â  Â  Â  Â  Â  // Uã‚¿ãƒ¼ãƒ³å®Œäº†å¾Œã€DRIVINGçŠ¶æ…‹ã«ç§»è¡Œ
Â  Â  Â  Â  Â  current_state = DRIVING;
Â  Â  Â  Â  Â  Serial.println("ğŸ”„ DRIVING resumed after U-turn.");
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case COMPLETE:
Â  Â  Â  Â  // ã€ãƒ”ãƒ¼ã‚¹ã‚’å–ã‚‹ã€‘(HIGH) -> ãƒªã‚»ãƒƒãƒˆ (WAIT_START)
Â  Â  Â  Â  if (metal_status == HIGH) {
Â  Â  Â  Â  Â  current_state = WAIT_START;
Â  Â  Â  Â  Â  Serial.println("â¹ï¸ Sequence Reset.");
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  default:
Â  Â  Â  Â  // äºˆæœŸã›ã¬çŠ¶æ…‹ã®å ´åˆã€å…¨ã¦åœæ­¢ã—ã¦ãƒªã‚»ãƒƒãƒˆçŠ¶æ…‹ã¸
Â  Â  Â  Â  stop_all_motors();
Â  Â  Â  Â  current_state = WAIT_START;
Â  Â  Â  Â  break;
Â  Â  }
Â  }

Â  // æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã®ãŸã‚ã«ã‚»ãƒ³ã‚µãƒ¼å€¤ã‚’æ›´æ–°
Â  lastMetalStatus = raw_metal_status;
}
</code></pre>
            </div>
        </div>
    </div>
</section>

<section id="chat" class="section dark-bg">
    <h3>ğŸ’¬ ç­å“¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ¼ãƒ‰</h3>
    <p class="process-preamble">ç­å“¡é–“ã§éåŒæœŸã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã®æ²ç¤ºæ¿ã§ã™ã€‚</p>

    <div class="chat-container animate-on-scroll">
        <div class="message-input">
            <input type="url" placeholder="PDF/ç”»åƒãªã©ã®å…±æœ‰URL (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)" id="fileUrlInput" class="file-input">
            <input type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." id="chatInput">
            <button onclick="postMessage()">é€ä¿¡</button>
        </div>
        <div class="message-board" id="messageBoard">
            </div>
    </div>
</section>


<footer class="site-footer dark-footer">
    <div class="footer-container">
        <div class="footer-section">
            <h4>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</h4>
            <ul>
                <li><a href="./index.html">å…¬é–‹ç”¨ã‚µã‚¤ãƒˆã¸æˆ»ã‚‹</a></li>
                <li><a href="#schedule">ä»Šå¾Œã®äºˆå®š</a></li>
                <li><a href="#resources">æŠ€è¡“ãƒªã‚½ãƒ¼ã‚¹</a></li>
                <li><a href="#code">èª¿æ•´ç”¨ã‚³ãƒ¼ãƒ‰</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>é€£çµ¡å…ˆ/ç®¡ç†è€…</h4>
            <ul>
                <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼: (æ°å)</li>
                <li>å›è·¯æ‹…å½“: (æ°å)</li>
                <li>é§†å‹•ç³»æ‹…å½“: (æ°å)</li>
            </ul>
        </div>
        <div class="footer-section contact-info">
            <h4>ã‚µã‚¤ãƒˆæƒ…å ±</h4>
            <p>æœ¬ã‚µã‚¤ãƒˆã¯A1ç­ã®é€²æ—ç®¡ç†å°‚ç”¨ã§ã™ã€‚</p>
            <p class="project-id">å‰µæˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ A1ç­ ç®¡ç†è€…ã‚µã‚¤ãƒˆ</p>
        </div>
    </div>
    
    <div class="footer-bottom">
        <p>&copy; å‰µæˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ A1ç­. All rights reserved.</p>
    </div>
</footer>

</div> <script>
// ====================================================================
// â˜…â˜…â˜… èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ â˜…â˜…â˜…
// ====================================================================

const VALID_USERS = ['Yuto', 'Arikawa', 'katunari', 'takuto'];
const VALID_PASSWORD = 'okadaiA1';
const AUTH_KEY = 'a1_admin_authenticated';
const USERNAME_KEY = 'a1_current_user'; // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä¿å­˜ã™ã‚‹ã‚­ãƒ¼

function checkAuth() {
    const usernameInput = document.getElementById('username').value.trim();
    const passwordInput = document.getElementById('password').value.trim();
    const message = document.getElementById('auth-message');

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒã‚§ãƒƒã‚¯
    const isUserValid = VALID_USERS.includes(usernameInput);
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
    const isPasswordValid = (passwordInput === VALID_PASSWORD);

    if (isUserValid && isPasswordValid) {
        // èªè¨¼æˆåŠŸ
        message.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼';
        localStorage.setItem(AUTH_KEY, 'true'); 
        localStorage.setItem(USERNAME_KEY, usernameInput); // â˜… ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä¿å­˜ â˜…
        showContent();
    } else {
        // èªè¨¼å¤±æ•—
        message.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚';
        document.getElementById('password').value = ''; 
    }
}

// èªè¨¼çŠ¶æ…‹ã«å¿œã˜ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
function showContent() {
    document.getElementById('auth-container').style.display = 'none';
    document.getElementById('content-wrapper').style.display = 'block';
    loadMessages(); // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºå¾Œã«ãƒãƒ£ãƒƒãƒˆã‚’ãƒ­ãƒ¼ãƒ‰
}

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ 
function logout() {
    localStorage.removeItem(AUTH_KEY);
    localStorage.removeItem(USERNAME_KEY);
    // ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã™
    window.location.reload(); 
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
if (localStorage.getItem(AUTH_KEY) === 'true') {
    showContent();
}

// ====================================================================
// â˜…â˜…â˜… ãã®ä»–ã®JSãƒ­ã‚¸ãƒƒã‚¯ (ãƒãƒ£ãƒƒãƒˆæ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’å«ã‚€) â˜…â˜…â˜…
// ====================================================================

// --- JS: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç† (ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨å…±é€š) ---
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
    }
  });
});
document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));

// --- JS: ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‡¦ç† (ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨å…±é€š) ---
function toggleMenu() {
  const menu = document.getElementById("mobileMenu");
  menu.classList.toggle("is-open"); 
}

// --- JS: ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
function copyCode(elementId) {
    const codeElement = document.getElementById(elementId);
    if (!codeElement) return;

    const codeText = codeElement.querySelector('code').textContent; 
    
    const tempTextArea = document.createElement('textarea');
    tempTextArea.value = codeText.trim();
    
    document.body.appendChild(tempTextArea);
    tempTextArea.select();
    document.execCommand('copy');
    document.body.removeChild(tempTextArea);
}


// ====================================================================
// â˜…â˜…â˜… ç­å“¡ãƒãƒ£ãƒƒãƒˆã®æ°¸ç¶šåŒ–æ©Ÿèƒ½ (localStorage) â˜…â˜…â˜…
// ====================================================================

const MESSAGE_STORAGE_KEY = 'a1_admin_chat_messages';

/**
 * ç”»é¢ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´ ã‚’ç”Ÿæˆã—è¿½åŠ ã™ã‚‹é–¢æ•°
 */
function createAndAppendMessage(author, timeStr, text, type, fileUrl) {
    const board = document.getElementById('messageBoard');
    const newMessage = document.createElement('div');
    
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿è€…åã‚’æ¯”è¼ƒã—ã¦ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®š
    const currentUser = localStorage.getItem(USERNAME_KEY);
    // è‡ªåˆ†ã®æŠ•ç¨¿ã§ã‚ã‚Œã° outgoing ã«ã™ã‚‹ï¼ˆä»–ã®ç­å“¡ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚è‡ªåˆ†ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ outgoingï¼‰
    const messageType = (currentUser === author) ? 'outgoing' : type; 

    newMessage.className = `message ${messageType}`;
    
    let fileHtml = '';
    if (fileUrl) {
        // ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã«åŸºã¥ã„ã¦è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        const ext = fileUrl.split('.').pop().toLowerCase();
        let linkText = 'æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã';

        if (ext === 'pdf') {
            linkText = 'PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã ğŸ“„';
        } else if (['png', 'jpg', 'jpeg', 'gif'].includes(ext)) {
            // ç”»åƒã®å ´åˆã¯ã‚µãƒ ãƒã‚¤ãƒ«ã‚’è¡¨ç¤º (URLãŒç›´ãƒªãƒ³ã‚¯ã®å ´åˆã®ã¿å‹•ä½œ)
            fileHtml = `<div class="file-attachment"><a href="${fileUrl}" target="_blank" class="resource-link"><img src="${fileUrl}" alt="æ·»ä»˜ç”»åƒ" style="max-width: 100px; max-height: 100px; display: block; margin-bottom: 5px; object-fit: contain;"></a><a href="${fileUrl}" target="_blank">${linkText}</a></div>`;
        } else {
            fileHtml = `<div class="file-attachment"><a href="${fileUrl}" target="_blank" class="resource-link">${linkText}</a></div>`;
        }
    }

    // æŠ•ç¨¿è€…åã®è¡¨ç¤ºã‚’ä¿®æ­£
    const displayAuthor = author;

    newMessage.innerHTML = `
        <span class="author">${displayAuthor}</span>
        <span class="time">${timeStr}</span>
        <p>${text}</p>
        ${fileHtml} 
    `;
    board.appendChild(newMessage);
    board.scrollTop = board.scrollHeight;
}

/**
 * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã—ã€localStorageã«ä¿å­˜ã™ã‚‹é–¢æ•°
 */
function postMessage() {
    const input = document.getElementById('chatInput');
    const urlInput = document.getElementById('fileUrlInput'); 
    
    const text = input.value.trim();
    const fileUrl = urlInput.value.trim();
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚URLã‚‚ç©ºã®å ´åˆã¯å‡¦ç†ã—ãªã„
    if (!text && !fileUrl) {
        return;
    }

    const now = new Date();
    const timeStr = `${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
    
    // ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’æŠ•ç¨¿è€…åã¨ã—ã¦å–å¾—
    const author = localStorage.getItem(USERNAME_KEY) || "ã‚²ã‚¹ãƒˆ";

    // 1. ç”»é¢ã«è¿½åŠ 
    createAndAppendMessage(author, timeStr, text, 'outgoing', fileUrl); 

    // 2. localStorageã«ä¿å­˜
    const savedMessages = getStoredMessages();
    savedMessages.push({
        author: author,
        time: timeStr,
        text: text,
        type: 'outgoing', 
        fileUrl: fileUrl
    });
    localStorage.setItem(MESSAGE_STORAGE_KEY, JSON.stringify(savedMessages));

    // 3. å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
    input.value = '';
    urlInput.value = '';
}

/**
 * localStorageã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
 */
function getStoredMessages() {
    const json = localStorage.getItem(MESSAGE_STORAGE_KEY);
    if (json) {
        try {
            return JSON.parse(json);
        } catch (e) {
            console.error("Failed to parse stored messages:", e);
        }
    }
    // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (æŠ•ç¨¿è€…åã¨fileUrl)
    return [
        { author: "katunari", time: "2025/11/30 14:30", text: "Uã‚¿ãƒ¼ãƒ³è§’åº¦ã‚’145åº¦ã«å¾®èª¿æ•´ã—ãŸã¨ã“ã‚ã€å®‰å®šæ€§ãŒå‘ä¸Šã—ã¾ã—ãŸã€‚UTURN_DURATION_MSã¯1450msã§ãƒ†ã‚¹ãƒˆä¸­ã§ã™ã€‚", type: "incoming", fileUrl: "" },
        { author: "Arikawa", time: "2025/11/30 15:45", text: "äº†è§£ã€‚ãã®ã‚³ãƒ¼ãƒ‰ã‚’ä»Šæ—¥ã®å¤•æ–¹ã«ã€Œèª¿æ•´ç”¨ã‚³ãƒ¼ãƒ‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åæ˜ ã—ã¦ãŠãã¾ã™ã€‚", type: "outgoing", fileUrl: "" },
        { author: "Yuto", time: "2025/11/30 18:00", text: "å›è·¯å›³ã®é›»æºåˆ†é›¢ã®å ´æ‰€ã«ã¤ã„ã¦ã€å°‘ã—è³ªå•ãŒã‚ã‚Šã¾ã™ã€‚æ˜æ—¥ã®æœä¼šã§ç¢ºèªã•ã›ã¦ãã ã•ã„ã€‚", type: "incoming", fileUrl: "https://example.com/circuit_question.pdf" } 
    ];
}

/**
 * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢ã—ã€ä¿å­˜ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾©å…ƒã™ã‚‹é–¢æ•°
 */
function loadMessages() {
    const board = document.getElementById('messageBoard');
    board.innerHTML = ''; 
    
    const messages = getStoredMessages();
    messages.forEach(msg => {
        // ãƒ­ãƒ¼ãƒ‰æ™‚ã¯ã€ä¿å­˜ã•ã‚Œã¦ã„ã‚‹typeã¨ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¯”è¼ƒã—ã¦è¡¨ç¤ºã‚¿ã‚¤ãƒ—ã‚’æ±ºå®š
        const isOutgoing = (localStorage.getItem(USERNAME_KEY) === msg.author);
        const displayType = isOutgoing ? 'outgoing' : 'incoming';
        
        createAndAppendMessage(msg.author, msg.time, msg.text, displayType, msg.fileUrl);
    });
}

// loadMessages() ã¯èªè¨¼æˆåŠŸæ™‚ (showContent) ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™

</script>
</body>
</html>
